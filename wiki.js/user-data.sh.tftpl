#!/bin/bash
set -euxo pipefail

# Set system timezone
timedatectl set-timezone Australia/Brisbane

# Install Docker
dnf install -y docker
systemctl enable --now docker

# Install Docker Compose plugin
mkdir -p /usr/local/lib/docker/cli-plugins
curl -SL "https://github.com/docker/compose/releases/latest/download/docker-compose-linux-x86_64" \
  -o /usr/local/lib/docker/cli-plugins/docker-compose
chmod +x /usr/local/lib/docker/cli-plugins/docker-compose

# Create data directory
mkdir -p /opt/wiki

# Write docker-compose.yml
cat > /opt/wiki/docker-compose.yml <<'COMPOSE'
${docker_compose_yml}
COMPOSE

# Start Wiki.js
cd /opt/wiki
docker compose up -d
